---
import {getCollection, getEntries} from "astro:content";

import GlobalLayout from "../../patterns/layouts/GlobalLayout/GlobalLayout.astro";
import CardComplexListing from "src/patterns/components/CardComplexListing/CardComplexListing.astro";

const unsortedBlogPosts = await getCollection('blog-posts')
const sortedBlogPosts = unsortedBlogPosts
	.sort((p1, p2) => (p1.data.createdAt < p2.data.createdAt ? 1 : -1))

const blogPosts = []
for (const blogPost of sortedBlogPosts) {
	const relatedTags = await getEntries(blogPost.data.tags)

	blogPosts.push({
		...blogPost,
		referenced: {
			tags: relatedTags
		}
	})
}
---

<GlobalLayout title="Blog">
	<CardComplexListing
		title="📝 Blog Posts"
		description="<p>Exploring thoughts, concepts and opinions. For technical how-tos, references, quick-tips and tutorials see my <a href='/guides'>guides</a>.</p>"
		notFoundText="No Blog Posts Found"
		cards={blogPosts.map(blogPost => {
			return {
				title: blogPost.data.title,
				description: blogPost.data.description,
				link: `/blog/${blogPost.id}`,
				tags: blogPost.referenced.tags,
				createdAt: blogPost.data.createdAt,
				updatedAt: blogPost.data.updatedAt,
			}
		})}
	/>
</GlobalLayout>
