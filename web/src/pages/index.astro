---
import {getCollection} from "astro:content";

import GlobalLayout from '../patterns/layouts/GlobalLayout/GlobalLayout.astro';
import Greeter from "../patterns/components/Greeter/Greeter.astro";
import CardSimpleListing from "../patterns/components/CardSimpleListing/CardSimpleListing.astro";

import directus from "../lib/directus";
import {readSingleton} from "@directus/sdk";

const homeContent = await directus.request(readSingleton('home'));
const socialLinks = [
    {
        text: "GitHub",
        url: "https://github.com/ben-ryder",
        iconCode: "github"
    },
    {
        text: "LinkedIn",
        url: "https://www.linkedin.com/in/benryderdev",
        iconCode: "linkedin"
    }
]

// todo: add sorting based on a specific order/rank property rather than createdAt timestamp?
const unsortedFeaturedProjects = await getCollection('projects', ({data}) => {
	return data.status === 'published' && data.featured
})
const featuredProjects = unsortedFeaturedProjects.sort((p1, p2) => (p1.data.created_at < p2.data.created_at ? 1 : -1))

const unsortedFeaturedPosts = await getCollection('posts', ({data}) => {
    return data.status === 'published' && data.featured
})
const featuredPosts = unsortedFeaturedPosts.sort((p1, p2) => (p1.data.created_at < p2.data.created_at ? 1 : -1))

---

<GlobalLayout title="Home">
	<Greeter
		contentHtml={homeContent.greeter}
		socialLinks={socialLinks}
	/>

	<CardSimpleListing
		title="👨‍💻 Projects"
		viewAllText="All Projects"
		viewAllLink="/projects"
		cards={featuredProjects.map(project => {
			return {
				title: project.data.name,
				description: project.data.description,
				link: `/projects/${project.id}`
			}
		})}
	/>

    <CardSimpleListing
			title="📝 Posts"
			viewAllText="All Posts"
			viewAllLink="/posts"
			cards={featuredPosts.map(post => {
				return {
					title: post.data.name,
					description: post.data.description,
					link: `/posts/${post.id}`
				}
			})}
    />

</GlobalLayout>
