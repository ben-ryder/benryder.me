---
import {getCollection} from "astro:content";

import GlobalLayout from '../patterns/layouts/GlobalLayout/GlobalLayout.astro';
import Greeter from "../patterns/components/Greeter/Greeter.astro";
import CardSimpleListing from "../patterns/components/CardSimpleListing/CardSimpleListing.astro";

import { compiledContent as getGreeterHtml } from "../content-static/home-greeter.md"

// todo: add sorting based on a specific order/rank property rather than createdAt timestamp?

const unsortedFeaturedProjects = await getCollection('projects', (p) => {
	return p.data.isFeatured
})
const featuredProjects = unsortedFeaturedProjects.sort((p1, p2) => (p1.data.createdAt < p2.data.createdAt ? 1 : -1))

const unsortedFeaturedBlogPosts = await getCollection('blog-posts', (p) => {
	return p.data.isFeatured
})
const featuredBlogPosts = unsortedFeaturedBlogPosts.sort((p1, p2) => (p1.data.createdAt < p2.data.createdAt ? 1 : -1))

const socialLinks = [
	{
		text: "GitHub",
		url: "https://github.com/ben-ryder",
		iconCode: "github"
	},
	{
		text: "LinkedIn",
		url: "https://www.linkedin.com/in/benryderdev",
		iconCode: "linkedin"
	}
]
---

<GlobalLayout title="Home">
	<Greeter
		contentHtml={getGreeterHtml()}
		socialLinks={socialLinks}
	/>

	<CardSimpleListing
		title="👨‍💻 Projects"
		viewAllText="All Projects"
		viewAllLink="/projects"
		cards={featuredProjects.map(project => {
			return {
				title: project.data.title,
				description: project.data.description,
				link: `/projects/${project.slug}`
			}
		})}
	/>

	<CardSimpleListing
		title="🗒️ Blog Posts"
		viewAllText="All Blog Posts"
		viewAllLink="/blog"
		cards={featuredBlogPosts.map(blogPost => {
			return {
				title: blogPost.data.title,
				description: blogPost.data.description,
				link: `/blog/${blogPost.slug}`
			}
		})}
	/>

</GlobalLayout>
